# Paths to the JSON files
$sample1Path = "C:\path\to\sample1.json"
$sample2Path = "C:\path\to\sample2.json"

# Load the JSON data
$sample1 = Get-Content -Raw -Path $sample1Path | ConvertFrom-Json
$sample2 = Get-Content -Raw -Path $sample2Path | ConvertFrom-Json

# Extract the structure and data
$structure1 = $sample1[0]
$data1 = $sample1[1]

$structure2 = $sample2[0]
$data2 = $sample2[1]

# Function to compare two JSON objects
function Compare-JsonObjects {
    param (
        [Parameter(Mandatory=$true)]
        [pscustomobject]$object1,
        
        [Parameter(Mandatory=$true)]
        [pscustomobject]$object2
    )

    $differences = @()

    # Get all property names from both objects
    $allProperties = ($object1.PSObject.Properties.Name + $object2.PSObject.Properties.Name) | Sort-Object -Unique

    # Compare each property
    foreach ($property in $allProperties) {
        if (-not $object1.PSObject.Properties[$property]) {
            $differences += "Property '$property' found in object 2 but missing in object 1."
        } elseif (-not $object2.PSObject.Properties[$property]) {
            $differences += "Property '$property' found in object 1 but missing in object 2."
        } elseif ($object1.$property -ne $object2.$property) {
            $differences += "Difference in property '$property': object1='$($object1.$property)' object2='$($object2.$property)'"
        }
    }

    return $differences
}

# Function to compare two datasets (array of objects)
function Compare-JsonData {
    param (
        [Parameter(Mandatory=$true)]
        [array]$data1,
        
        [Parameter(Mandatory=$true)]
        [array]$data2
    )

    $differences = @()

    # Compare object count
    if ($data1.Count -ne $data2.Count) {
        $differences += "The number of objects differs: sample1=$($data1.Count) sample2=$($data2.Count)"
    }

    # Compare each object by matching "State" and "LGA"
    foreach ($object1 in $data1) {
        $matchingObject = $data2 | Where-Object { $_.State -eq $object1.State -and $_.LGA -eq $object1.LGA }
        
        if ($matchingObject) {
            # Compare the matching objects
            $diff = Compare-JsonObjects -object1 $object1 -object2 $matchingObject
            if ($diff.Count -gt 0) {
                $differences += "Differences in object with State='$($object1.State)' and LGA='$($object1.LGA)':"
                $differences += $diff
            }
        } else {
            $differences += "Object with State='$($object1.State)' and LGA='$($object1.LGA)' found in sample1 but not in sample2."
        }
    }

    # Check for objects present in sample2 but missing in sample1
    foreach ($object2 in $data2) {
        $matchingObject = $data1 | Where-Object { $_.State -eq $object2.State -and $_.LGA -eq $object2.LGA }
        
        if (-not $matchingObject) {
            $differences += "Object with State='$($object2.State)' and LGA='$($object2.LGA)' found in sample2 but not in sample1."
        }
    }

    return $differences
}

# Compare the structures
if ($structure1 -ne $structure2) {
    Write-Output "The structures are different."
} else {
    Write-Output "The structures are identical."
}

# Compare the data
$differences = Compare-JsonData -data1 $data1 -data2 $data2

# Output the results
if ($differences.Count -eq 0) {
    Write-Output "The two JSON files are identical."
} else {
    Write-Output "The two JSON files are not identical. Differences:"
    $differences | ForEach-Object { Write-Output $_ }
}
