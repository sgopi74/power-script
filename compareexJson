# Paths to the JSON files
$sample1Path = "C:\path\to\sample1.json"
$sample2Path = "C:\path\to\sample2.json"

# Load the JSON data
$sample1 = Get-Content -Raw -Path $sample1Path | ConvertFrom-Json
$sample2 = Get-Content -Raw -Path $sample2Path | ConvertFrom-Json

# Function to compare two JSON objects
function Compare-JsonObjects {
    param (
        [Parameter(Mandatory=$true)]
        [pscustomobject]$object1,
        
        [Parameter(Mandatory=$true)]
        [pscustomobject]$object2
    )

    $differences = @()

    # Get all property names from both objects
    $allProperties = ($object1.PSObject.Properties.Name + $object2.PSObject.Properties.Name) | Sort-Object -Unique

    # Compare each property
    foreach ($property in $allProperties) {
        if (-not $object1.PSObject.Properties[$property]) {
            $differences += "Property '$property' found in object 2 but missing in object 1."
        } elseif (-not $object2.PSObject.Properties[$property]) {
            $differences += "Property '$property' found in object 1 but missing in object 2."
        } elseif ($object1.$property -ne $object2.$property) {
            $differences += "Difference in property '$property': object1='$($object1.$property)' object2='$($object2.$property)'"
        }
    }

    return $differences
}

# Function to compare two datasets (array of objects) without hardcoding property names
function Compare-JsonData {
    param (
        [Parameter(Mandatory=$true)]
        [array]$data1,
        
        [Parameter(Mandatory=$true)]
        [array]$data2
    )

    $differences = @()

    # Sort both datasets by all available properties
    $sortedData1 = $data1 | Sort-Object -Property *
    $sortedData2 = $data2 | Sort-Object -Property *

    # Compare object count
    if ($sortedData1.Count -ne $sortedData2.Count) {
        $differences += "The number of objects differs: sample1=$($sortedData1.Count) sample2=$($sortedData2.Count)"
    }

    # Compare each object
    for ($i = 0; $i -lt $sortedData1.Count; $i++) {
        $object1 = $sortedData1[$i]
        $object2 = $sortedData2[$i]

        $diff = Compare-JsonObjects -object1 $object1 -object2 $object2
        if ($diff.Count -gt 0) {
            $differences += "Differences in object at index $i:"
            $differences += $diff
        }
    }

    return $differences
}

# Compare the structures
if ($sample1.Structure -ne $sample2.Structure) {
    Write-Output "The structures are different."
} else {
    Write-Output "The structures are identical."
}

# Compare the data
$differences = Compare-JsonData -data1 $sample1.Data -data2 $sample2.Data

# Output the results
if ($differences.Count -eq 0) {
    Write-Output "The two JSON files are identical."
} else {
    Write-Output "The two JSON files are not identical. Differences:"
    $differences | ForEach-Object { Write-Output $_ }
